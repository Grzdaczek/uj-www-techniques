<!DOCTYPE html>
<html lang="pl">
  <head>
    <title>Pollik</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <label for="question">Question:</label>
    <input id="questionInput" type="text" />
    <input type="button" id="addOptionButton" value="add option" />
    <hr />
    <form id="optionsForm"></form>
    <input type="submit" id="submitButton" value="create" />
  </body>
  <script>
    const options = [];
    const optionsForm = document.getElementById("optionsForm");
    const addOptionButton = document.getElementById("addOptionButton");
    const submitButton = document.getElementById("submitButton");
    const questionInput = document.getElementById("questionInput");

    addOptionButton.addEventListener("click", () => {
      const index = options.length;
      options.push("");

      const input = document.createElement("input");
      input.style = "display: block;";
      input.type = "text";
      input.required = true;
      input.addEventListener("input", (e) => {
        options[index] = e.target.value;
      });

      optionsForm.appendChild(input);
    });

    submitButton.addEventListener("click", async (e) => {
      const question = questionInput.value;
      const result = await fetch("http://localhost:9000/poll/create", {
        method: "POST",
        headers: {
          "Access-Control-Allow-Origin": "*",
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ question, options }),
      });

      const { token, code } = await result.json();
      window.localStorage.setItem(code, token);
      window.location.replace(`poll.html?code=${code}`);
    });
  </script>
</html>
